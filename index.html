<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auréliya Sovereign AI System</title>
  <style>
    :root{--bg1:#432889;--bg2:#9e85d4;--text:#fff;--accent:gold;--glass:rgba(255,255,255,.12);--glass2:rgba(255,255,255,.2)}
    *{box-sizing:border-box}
    body{margin:0;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--text);min-height:100vh}
    header.nav{position:sticky;top:0;z-index:50;display:flex;gap:12px;align-items:center;justify-content:center;padding:12px 16px;background:rgba(0,0,0,.25);backdrop-filter:blur(8px)}
    header.nav button{background:transparent;border:none;color:var(--text);padding:8px 12px;cursor:pointer}
    header.nav button:hover{background:var(--glass2);border-radius:10px}
    header.nav input{margin-left:12px;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.1);color:white;min-width:220px}
    main{max-width:1100px;margin:32px auto;padding:16px}
    .hero{display:grid;place-items:center;min-height:70vh;text-align:center}
    .halo{width:220px;height:220px;border:4px solid var(--accent);border-radius:50%;box-shadow:0 0 20px var(--accent);margin-bottom:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--glass);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:16px}
    .card button{margin-top:10px}
    pre{white-space:pre-wrap;background:rgba(0,0,0,.25);padding:10px;border-radius:10px}
  </style>
</head>
<body>
  <header id="hdr" class="nav"></header>
  <main id="main"><div style="padding:16px">Loading…</div></main>

  <script type="module">
    /************ Registry ************/
    const Registry = {
      _all: {},
      add(m){ this._all[m.id] = m; },
      get(id){ return this._all[id]; },
      list(){ return Object.values(this._all); }
    };

    /************ Helpers ************/
    const backBtn = `<button id="backToModules">↩ Back to Modules</button>`;
    function onBack(el){ el.querySelector('#backToModules').onclick = ()=> location.hash = '#/modules'; }
    function placeholderModule(id, name, emoji='🧩'){
      return {
        id, name,
        render(el){
          el.innerHTML = `
            <div class="card">
              <h2>${emoji} ${name}</h2>
              <p><small>ID: ${id}</small></p>
              <p>Placeholder UI. Wire in module-specific logic and API calls here.</p>
              ${backBtn}
            </div>`;
          onBack(el);
        }
      };
    }

    /************ First 4 live-wired modules ************/
    Registry.add({
      id: "01-trustos", name: "TrustOS",
      async render(el){
        el.innerHTML = `<div class="card">
          <h2>🔐 TrustOS</h2>
          <p>This module checks server time via <code>/api/time</code>.</p>
          <button id="btnTime">Get Server Time</button>
          <pre id="out">Click the button…</pre>
          ${backBtn}
        </div>`;
        el.querySelector('#btnTime').onclick = async ()=>{
          try{
            const r = await fetch('/api/time'); const j = await r.json();
            el.querySelector('#out').textContent = JSON.stringify(j, null, 2);
          }catch(e){ el.querySelector('#out').textContent = String(e); }
        };
        onBack(el);
      }
    });

    Registry.add({
      id: "02-sovereignwealth", name: "SovereignWealth",
      async render(el){
        el.innerHTML = `<div class="card">
          <h2>💰 SovereignWealth</h2>
          <p>Connectivity test via <code>/api/ping</code>.</p>
          <button id="btnPing">Ping</button>
          <pre id="out">Click Ping…</pre>
          ${backBtn}
        </div>`;
        el.querySelector('#btnPing').onclick = async ()=>{
          try{
            const r = await fetch('/api/ping'); const j = await r.json();
            el.querySelector('#out').textContent = JSON.stringify(j, null, 2);
          }catch(e){ el.querySelector('#out').textContent = String(e); }
        };
        onBack(el);
      }
    });

    Registry.add({
      id: "03-mirrorme", name: "MirrorMe",
      async render(el){
        el.innerHTML = `<div class="card">
          <h2>🪞 MirrorMe</h2>
          <p>Sends JSON to <code>/api/echo</code> and shows the reply.</p>
          <textarea id="payload" rows="5" style="width:100%">{ "hello": "Sabrina", "module": "MirrorMe" }</textarea>
          <button id="btnEcho">Send</button>
          <pre id="out">Type JSON and click Send…</pre>
          ${backBtn}
        </div>`;
        el.querySelector('#btnEcho').onclick = async ()=>{
          try{
            const body = el.querySelector('#payload').value;
            const r = await fetch('/api/echo', { method:'POST', headers:{'Content-Type':'application/json'}, body });
            const j = await r.json();
            el.querySelector('#out').textContent = JSON.stringify(j, null, 2);
          }catch(e){ el.querySelector('#out').textContent = String(e); }
        };
        onBack(el);
      }
    });

    Registry.add({
      id: "04-boardroomaccess", name: "Boardroom Access",
      async render(el){
        el.innerHTML = `<div class="card">
          <h2>🏛️ Boardroom Access</h2>
          <p>Calls <code>/api/openai</code>. If <code>OPENAI_API_KEY</code> isn't set in Vercel, you'll see a safe mock reply.</p>
          <input id="prompt" placeholder="Prompt" value="Draft a 1-sentence greeting for Auréliya Holdings." style="width:100%;padding:8px"/>
          <button id="btnGo">Run</button>
          <pre id="out">Enter a prompt and click Run…</pre>
          ${backBtn}
        </div>`;
        el.querySelector('#btnGo').onclick = async ()=>{
          try{
            const prompt = el.querySelector('#prompt').value;
            const r = await fetch('/api/openai', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({prompt}) });
            const j = await r.json();
            el.querySelector('#out').textContent = JSON.stringify(j, null, 2);
          }catch(e){ el.querySelector('#out').textContent = String(e); }
        };
        onBack(el);
      }
    });

    /************ Named placeholders 05–07 ************/
    Registry.add(placeholderModule("05-aureliyaair","Auréliya Air","✈️"));
    Registry.add(placeholderModule("06-quantumincomerouter","Quantum Income Router","💠"));
    Registry.add(placeholderModule("07-legaladvisor","Legal Advisor","📜"));

    /************ Auto-generate 08–56 ************/
    const emojis = ["🧩","⚙️","📁","🔎","🛰️","🧠","🛡️","🧪","📡","🗂️","🧭","🧬","📈","🖼️","🎛️","🔧","🪙","🎯","🧰","🧯","🗝️","🎚️","🧿","🔒","💼","💳","🔮","🧱","🪄","🧵","🏷️","🗜️","📦","🗃️","🕹️","🛠️","📜","💡","🧲","🌀","🎞️","🧾","🧷"];
    for(let i=8;i<=56;i++){
      const id = `${String(i).padStart(2,'0')}-module${String(i).padStart(2,'0')}`;
      Registry.add(placeholderModule(id, `Module ${String(i).padStart(2,'0')}`, emojis[(i-8)%emojis.length]));
    }

    /************ Header ************/
    function renderHeader(){
      const el = document.getElementById('hdr');
      el.innerHTML = `
        <button data-nav="#/home">🏠 Home</button>
        <button data-nav="#/modules">🧩 Modules</button>
        <button data-nav="#/module/01-trustos">🔐 Trust</button>
        <button data-nav="#/module/02-sovereignwealth">💰 Wealth</button>
        <button data-nav="#/module/03-mirrorme">🪞 Mirror</button>
        <button data-nav="#/module/04-boardroomaccess">🏛️ Boardroom</button>
        <input id="app-search" placeholder="Search modules…"/>
      `;
      el.addEventListener('click', (e)=>{
        const b = e.target.closest('[data-nav]'); if(b){ location.hash=b.dataset.nav; }
      });
      el.querySelector('#app-search').addEventListener('keydown', e=>{
        if(e.key==='Enter'){ location.hash = '#/search?q=' + encodeURIComponent(e.target.value.trim()); }
      });
    }

    /************ Router ************/
    function parseHash(){
      const h = location.hash || '#/home';
      const [path, query=''] = h.slice(1).split('?');
      return { parts: path.split('/').filter(Boolean), params: new URLSearchParams(query) };
    }
    function renderHome(){
      document.getElementById('main').innerHTML = `
        <section class="hero">
          <div class="halo"></div>
          <h1>Welcome back, Sabrina ✨</h1>
          <p>Your Sovereign AI Lifestyle System is live. Open a module to test API routes.</p>
          <div style="margin-top:14px;">
            <a href="#/modules" class="card-btn">Browse Modules</a>
          </div>
        </section>`;
    }
    function renderModuleGrid(){
      const cards = Registry.list().map(m => `
        <div class="card">
          <h3>${m.name}</h3>
          <p>ID: ${m.id}</p>
          <a href="#/module/${m.id}">Open</a>
        </div>`).join('');
      document.getElementById('main').innerHTML = `<h2>All Modules</h2><div class="grid">${cards}</div>`;
    }
    function renderSearch(q){
      const n=q.toLowerCase();
      const results = Registry.list().filter(m=>m.name.toLowerCase().includes(n)||m.id.toLowerCase().includes(n));
      document.getElementById('main').innerHTML = results.length
        ? `<h2>Search: ${q}</h2><div class="grid">${results.map(m=>`
            <div class="card"><h3>${m.name}</h3><p>ID: ${m.id}</p><a href="#/module/${m.id}">Open</a></div>`).join('')}</div>`
        : `<p>No results for <b>${q}</b>.</p>`;
    }
    function startRouter(){
      const main = document.getElementById('main');
      function route(){
        const {parts, params} = parseHash();
        if(parts.length===0 || parts[0]==='home') return renderHome();
        if(parts[0]==='modules') return renderModuleGrid();
        if(parts[0]==='search') return renderSearch(params.get('q')||'');
        if(parts[0]==='module' && parts[1]){
          const mod = Registry.get(parts[1]);
          if(!mod){ main.innerHTML = '<p>Module not found.</p>'; return; }
          main.innerHTML = ''; const mount=document.createElement('div'); main.appendChild(mount); mod.render(mount); return;
        }
        main.innerHTML = '<p>Not found.</p>';
      }
      addEventListener('hashchange', route); route();
    }

    renderHeader();
    startRouter();
  <script type="module">
  import { renderHeader } from './app/ui/header.js';
  import { startRouter } from './app/router.js';
  import * as Registry from './app/modules/registry.js';
  renderHeader(document.getElementById('hdr') || document.body.appendChild(Object.assign(document.createElement('header'),{id:'hdr'})));
  startRouter(document.getElementById('main') || document.body.appendChild(Object.assign(document.createElement('main'),{id:'main'})), Registry);
</script>
</body>
</html>
<!-- add somewhere in <body>: -->
<header id="hdr"></header>
<main id="main"></main>

<script type="module">
  // Show fatal JS errors on the page (handy on iPhone)
  window.addEventListener('error', e=>{
    const pre=document.createElement('pre');
    pre.textContent='Error: '+e.message;
    document.body.prepend(pre);
  });
  window.addEventListener('unhandledrejection', e=>{
    const pre=document.createElement('pre');
    pre.textContent='Promise Rejection: '+(e.reason?.message||e.reason);
    document.body.prepend(pre);
  });

  // IMPORTANT: paths match your repo layout
  import { renderHeader } from './app/ui/header.js';
  import { startRouter } from './app/ui/router.js';
  import { Registry } from './app/modules/registry.js';

  const hdr  = document.getElementById('hdr');
  const main = document.getElementById('main');

  renderHeader(hdr, Registry);        // draws the top nav
  startRouter(main, Registry);        // boots the SPA router
</script>
